<?xml version="1.0" encoding="UTF-8"?>
<POWERMART>
  <REPOSITORY NAME="REP_DEV" VERSION="184.93">
    <FOLDER NAME="CHK_DIGIT_VALIDATOR" SHARED="NOTSHARED">
      <MAPPING DESCRIPTION="Checksum logic mapping" ISVALID="YES" NAME="m_Checksum_Validation" OBJECTVERSION="1">

        <!-- Source Definition -->
        <SOURCE BUSINESSNAME="" DATABASETYPE="FlatFile" NAME="src_AccountNumbers" OBJECTVERSION="1" VERSIONNUMBER="1">
          <FLATFILE DELIMITED="YES" DELIMITEDBY="," ESCAPE_CHARACTER="" KEEPESCAPECHAR="NO" LINESEQUENTIAL="NO" MULTIDELIMITEDBY="" REPEATABLE="NO" ROWDELIMITER="\n" SKIPROWS="0" TEXTQUALIFIER="NONE">
            <FIELD DATATYPE="string" DESCRIPTION="" FIELDNUMBER="1" KEYTYPE="NOT A KEY" LENGTH="11" NAME="ACC_NUM" OFFSET="0" PHYSICALLENGTH="11" PHYSICALOFFSET="0" USAGE_FLAGS=""/>
          </FLATFILE>
        </SOURCE>

        <!-- Expression Transformation -->
        <TRANSFORMATION DESCRIPTION="Checksum logic" NAME="exp_Checksum" REUSABLE="NO" TYPE="Expression" VERSIONNUMBER="1">
          <TRANSFORMFIELD DATATYPE="string" DEFAULTVALUE="" DESCRIPTION="Account number" NAME="ACC_NUM" PORTTYPE="INPUT" PRECISION="11" SCALE="0"/>

          <!-- Digit extractions -->
          <TRANSFORMFIELD DATATYPE="integer" NAME="D1" EXPRESSION="TO_INTEGER(SUBSTR(ACC_NUM, 1, 1))" PORTTYPE="OUTPUT" PRECISION="3"/>
          <TRANSFORMFIELD DATATYPE="integer" NAME="D2" EXPRESSION="TO_INTEGER(SUBSTR(ACC_NUM, 2, 1))" PORTTYPE="OUTPUT" PRECISION="3"/>
          <TRANSFORMFIELD DATATYPE="integer" NAME="D3" EXPRESSION="TO_INTEGER(SUBSTR(ACC_NUM, 3, 1))" PORTTYPE="OUTPUT" PRECISION="3"/>
          <TRANSFORMFIELD DATATYPE="integer" NAME="D4" EXPRESSION="TO_INTEGER(SUBSTR(ACC_NUM, 4, 1))" PORTTYPE="OUTPUT" PRECISION="3"/>
          <TRANSFORMFIELD DATATYPE="integer" NAME="D5" EXPRESSION="TO_INTEGER(SUBSTR(ACC_NUM, 5, 1))" PORTTYPE="OUTPUT" PRECISION="3"/>
          <TRANSFORMFIELD DATATYPE="integer" NAME="D6" EXPRESSION="TO_INTEGER(SUBSTR(ACC_NUM, 6, 1))" PORTTYPE="OUTPUT" PRECISION="3"/>
          <TRANSFORMFIELD DATATYPE="integer" NAME="D7" EXPRESSION="TO_INTEGER(SUBSTR(ACC_NUM, 7, 1))" PORTTYPE="OUTPUT" PRECISION="3"/>
          <TRANSFORMFIELD DATATYPE="integer" NAME="D8" EXPRESSION="TO_INTEGER(SUBSTR(ACC_NUM, 8, 1))" PORTTYPE="OUTPUT" PRECISION="3"/>
          <TRANSFORMFIELD DATATYPE="integer" NAME="D9" EXPRESSION="TO_INTEGER(SUBSTR(ACC_NUM, 9, 1))" PORTTYPE="OUTPUT" PRECISION="3"/>
          <TRANSFORMFIELD DATATYPE="integer" NAME="D10" EXPRESSION="TO_INTEGER(SUBSTR(ACC_NUM, 10, 1))" PORTTYPE="OUTPUT" PRECISION="3"/>
          <TRANSFORMFIELD DATATYPE="integer" NAME="D11" EXPRESSION="TO_INTEGER(SUBSTR(ACC_NUM, 11, 1))" PORTTYPE="OUTPUT" PRECISION="3"/>

          <!-- Raw checksum calculation -->
          <TRANSFORMFIELD DATATYPE="integer" NAME="TOTAL_SUM" EXPRESSION="D1*2048 + D2*1024 + D3*512 + D4*256 + D5*128 + D6*64 + D7*32 + D8*16 + D9*8 + D10*4 + D11*2" PORTTYPE="OUTPUT" PRECISION="10"/>
          <TRANSFORMFIELD DATATYPE="integer" NAME="RAW_CHECKSUM" EXPRESSION="MOD(TOTAL_SUM, 11)" PORTTYPE="OUTPUT" PRECISION="2"/>
          <TRANSFORMFIELD DATATYPE="integer" NAME="FINAL_CHECKSUM" EXPRESSION="IIF(RAW_CHECKSUM = 1, -1, IIF(RAW_CHECKSUM != 0, 11 - RAW_CHECKSUM, 0))" PORTTYPE="OUTPUT" PRECISION="3"/>
        </TRANSFORMATION>

        <!-- Target -->
        <TARGET DESCRIPTION="Target with checksums" NAME="tgt_AccountChecksums" OBJECTVERSION="1" TABLEOPTIONS="" TYPE="FlatFile">
          <FIELD DATATYPE="string" DESCRIPTION="" KEYTYPE="NOT A KEY" LENGTH="11" NAME="ACC_NUM"/>
          <FIELD DATATYPE="integer" DESCRIPTION="" KEYTYPE="NOT A KEY" NAME="RAW_CHECKSUM"/>
          <FIELD DATATYPE="integer" DESCRIPTION="" KEYTYPE="NOT A KEY" NAME="FINAL_CHECKSUM"/>
        </TARGET>

      </MAPPING>
    </FOLDER>
  </REPOSITORY>
</POWERMART>
